-- wbuhub Key System
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService('Players')
local StarterGui = game:GetService('StarterGui')
local HttpService = game:GetService('HttpService')

local Constants = {
    VALID_KEY   = 'WBUx',
    KEY_FILE    = 'wbuhub/key.txt',
    DISCORD_URL = 'https://discord.gg/5ARTQYGvnX',
}

local function Notify(title, text, dur)
    pcall(function()
        StarterGui:SetCore('SendNotification', {
            Title    = title or 'wbuhub',
            Text     = text  or '',
            Duration = dur   or 3,
        })
    end)
end

-- Check saved key
local KeyOk = false
if isfile and readfile and isfile(Constants.KEY_FILE) then
    if readfile(Constants.KEY_FILE) == Constants.VALID_KEY then
        KeyOk = true
        Notify('Success', 'Valid key found! Loading...', 3)
    end
end

if not KeyOk then
    local Win = Rayfield:CreateWindow{
        Name               = 'wbuhub Key System',
        LoadingTitle       = 'wbuhub - Key Verification',
        LoadingSubtitle    = 'Enter your key to proceed',
        ConfigurationSaving = {Enabled = false},
        Discord            = {Enabled = true, Invite = '5ARTQYGvnX', RememberJoins = true},
        KeySystem          = false,
    }

    local Tab = Win:CreateTab('Key Input')

    Tab:CreateInput{
        Name               = 'Enter Key',
        PlaceholderText    = 'Type your key here...',
        RemoveTextAfterFocusLost = false,
        Callback           = function(txt)
            if txt == Constants.VALID_KEY then
                if writefile then pcall(function() writefile(Constants.KEY_FILE, txt) end) end
                KeyOk = true
                Win:Destroy()                 -- remove UI
                Notify('Success', 'Key verified! Loading script...', 3)
            else
                Notify('Error', 'Invalid key! Join Discord for a key.', 5)
            end
        end,
    }

    Tab:CreateButton{
        Name     = 'Join Discord for Key',
        Callback = function()
            if setclipboard then
                pcall(function()
                    setclipboard(Constants.DISCORD_URL)
                    Notify('Info', 'Discord invite copied!', 3)
                end)
            else
                Notify('Info', 'Join: '..Constants.DISCORD_URL, 5)
            end
        end,
    }

    -- copy invite on open
    if setclipboard then
        pcall(function()
            setclipboard(Constants.DISCORD_URL)
            Notify('Info', 'Discord invite copied! Join for key.', 5)
        end)
    end

    -- wait until key is accepted
    while not KeyOk do task.wait(0.5) end
end

-- ---- KEY ACCEPTED ----
task.wait(0.5)                                   -- requested delay
loadstring(game:HttpGet('https://raw.githubusercontent.com/Teonity/Wbu-Scripts/refs/heads/main/Loader'))()
